
<head>
<link rel="alternate" type="application/rss+xml" href="../../../../feed.xml" title="Load testing a server">

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<link rel="stylesheet" type="text/css" href="https://css-storage.s3.eu-central-1.amazonaws.com/common-vendor.b8ecfc406ac0b5f77a26.css">
<link rel="stylesheet" type="text/css" href="https://css-storage.s3.eu-central-1.amazonaws.com/fretboard.f32f2a8d5293869f0195.css">
<link rel="stylesheet" type="text/css" href="https://css-storage.s3.eu-central-1.amazonaws.com/pretty-vendor.83ac49e057c3eac4fce3.css">
<link rel="stylesheet" type="text/css" href="https://css-storage.s3.eu-central-1.amazonaws.com/pretty.0ae3265014f89d9850bf.css">
<link rel="stylesheet" type="text/css" href="../../../../css/misc.css">
<script type="text/javascript" id="MathJax-script" async
  src="/scripts/mathjax.js">
</script>
<style>
@font-face {
    font-family: MJXc-TeX-math-Iw;
    src: url(
        "https://assets.hackmd.io/build/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff")
}
@font-face {
    font-family: MJXZERO;
    src: url(
        "https://assets.hackmd.io/build/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff")
}
@font-face {
    font-family: MJXTEX;
    src: url(
        "https://assets.hackmd.io/build/MathJax/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff")
}
.math { font-family: MJXc-TeX-math-Iw }
</style>
</head>
<div id="doc" class="container-fluid markdown-body comment-enabled" data-hard-breaks="true">

<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Load testing a server" />
<meta name="twitter:image" content="https://danielratmiroff.com/images/logo.png" />

<br>
<h1 style="margin-bottom:7px"> Load testing a server </h1>
<small style="float:left; color: #888"> 2022 Jun 12 </small>
<small style="float:right; color: #888"><a href="../../../../index.html">See all posts</a></small>
<br> <br> <br>
<title> Load testing a server </title>
<p><strong>What is load testing?</strong> ‚ÅâÔ∏è</p>
<p>Quoting wikipedia:</p>
<blockquote>
<p>Load testing generally refers to <strong>the practice of modeling the expected usage of a software program by simulating multiple users accessing the program concurrently</strong>. As such, this testing &gt; is most relevant for multi-user systems; often one built using a client/server model, such as web servers.</p>
</blockquote>
<h2 id="lets-get-started">Let's get started! üèÅ</h2>
<p><strong>Installing requirements</strong> We are gonna load test our server using <a href="https://locust.io/">locust</a>, a simple and straight forward python library. ¬†</p>
<p>Install locust by running:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">pip3</span> install locust</a></code></pre></div>
<p><em>If you don't have python or pip3 installed, please checkout the following links:</em></p>
<blockquote>
<p>How to install python: (installation guide)[https://www.python.org/downloads/]</p>
</blockquote>
<blockquote>
<p>How to install pip3: (installation guide)[https://pip.pypa.io/en/stable/installation/]</p>
</blockquote>
<p>¬†</p>
<p>Test the installation:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">locust</span> -V</a></code></pre></div>
<h2 id="load-testing">Load testing</h2>
<p>Create a python file <code>locustfile.py</code> and add the following code in it:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" title="1"><span class="im">from</span> locust <span class="im">import</span> HttpUser, task</a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">class</span>  HelloWorldUser(HttpUser):</a>
<a class="sourceLine" id="cb3-4" title="4"><span class="at">@task</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw">def</span>  hello_world(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="va">self</span>.client.get(<span class="st">&quot;/&quot;</span>) <span class="co">#URL that we will request</span></a></code></pre></div>
<p>In the same folder, run:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="ex">locust</span></a></code></pre></div>
<p>You should see something similar to:</p>
<p><img src="https://raw.githubusercontent.com/Danielratmiroff/myblog/master/images/loadtest/terminal-start.jpg" alt="Terminal" /><br />
¬†</p>
<p>Now, you can access <strong><a href="http://localhost:8089/">http://localhost:8089/</a></strong> */ in your web-browser and you will see the locust UI</p>
<p><img src="https://raw.githubusercontent.com/Danielratmiroff/myblog/master/images/loadtest/locust.jpg" alt="Localhost UI" /><br />
¬†</p>
<blockquote>
<p>Configure according your preferred settings and off you go! üèéÔ∏è</p>
</blockquote>
<p>¬†</p>
<h3 id="testing">Testing</h3>
<p><img src="https://raw.githubusercontent.com/Danielratmiroff/myblog/master/images/loadtest/testing.jpg" alt="Testing Preview" /><br />
¬†</p>
<p>One you stop the ongoing test, you can analise your results using the different views that locust offers:</p>
<p><em>e.g.¬†Charts</em></p>
<p><img src="https://raw.githubusercontent.com/Danielratmiroff/myblog/master/images/loadtest/charts.jpg" alt="Charts" /><br />
¬†</p>
<p>or you can simply use the terminal view</p>
<p><img src="https://raw.githubusercontent.com/Danielratmiroff/myblog/master/images/loadtest/result-terminal.jpg" alt="Terminal view" /><br />
¬†</p>
<blockquote>
<p>Welldone! You have load tested a server using locust, congrats! üéâ</p>
</blockquote>
<p>¬†</p>
<hr />
<h2 id="one-step-further-a-more-realistic-test">One step further, a more realistic test</h2>
<p>Make a more realistic and suitable test by modifying the <code>locustfile</code> to your needs ¬†</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" title="1"><span class="im">import</span> time</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="im">from</span> json <span class="im">import</span> JSONDecodeError</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="im">from</span> locust <span class="im">import</span> HttpUser, task, between</a>
<a class="sourceLine" id="cb5-4" title="4"></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="kw">class</span> QuickstartUser(HttpUser):</a>
<a class="sourceLine" id="cb5-6" title="6"></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co"># Waiting time after between each task ran by users</span></a>
<a class="sourceLine" id="cb5-8" title="8">wait_time <span class="op">=</span> between(<span class="dv">1</span>, <span class="dv">5</span>) </a>
<a class="sourceLine" id="cb5-9" title="9"></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="at">@task</span></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="kw">def</span> hello_world(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb5-12" title="12">    <span class="va">self</span>.client.get(<span class="st">&quot;/hello&quot;</span>)</a>
<a class="sourceLine" id="cb5-13" title="13">    <span class="va">self</span>.client.get(<span class="st">&quot;/world&quot;</span>)</a>
<a class="sourceLine" id="cb5-14" title="14">    </a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co"># &quot;3&quot; refers to the task&#39;s weight (it&#39;s 3 times more likely to be ran)</span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="at">@task</span>(<span class="dv">3</span>) </a>
<a class="sourceLine" id="cb5-17" title="17"><span class="kw">def</span> view_items(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb5-18" title="18">    <span class="cf">for</span> item_id <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</a>
<a class="sourceLine" id="cb5-19" title="19">        <span class="co"># group requests with different parameters together</span></a>
<a class="sourceLine" id="cb5-20" title="20">        <span class="va">self</span>.client.get(<span class="ss">f&quot;/item?id=</span><span class="sc">{</span>item_id<span class="sc">}</span><span class="ss">&quot;</span>, name<span class="op">=</span><span class="st">&quot;/item&quot;</span>) </a>
<a class="sourceLine" id="cb5-21" title="21">        time.sleep(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-22" title="22"></a>
<a class="sourceLine" id="cb5-23" title="23"><span class="co"># call an API and validate its response</span></a>
<a class="sourceLine" id="cb5-24" title="24"><span class="cf">with</span> <span class="va">self</span>.client.post(<span class="st">&quot;/&quot;</span>, json<span class="op">=</span>{<span class="st">&quot;foo&quot;</span>: <span class="dv">42</span>, <span class="st">&quot;bar&quot;</span>: <span class="dv">69</span>}, catch_response<span class="op">=</span><span class="va">True</span>) <span class="im">as</span> response:</a>
<a class="sourceLine" id="cb5-25" title="25"><span class="cf">try</span>:</a>
<a class="sourceLine" id="cb5-26" title="26">    <span class="cf">if</span> response.json()[<span class="st">&quot;greeting&quot;</span>] <span class="op">!=</span> <span class="st">&quot;hello&quot;</span>:</a>
<a class="sourceLine" id="cb5-27" title="27">        response.failure(<span class="st">&quot;Did not get expected value in greeting&quot;</span>)</a>
<a class="sourceLine" id="cb5-28" title="28"><span class="cf">except</span> JSONDecodeError:</a>
<a class="sourceLine" id="cb5-29" title="29">    response.failure(<span class="st">&quot;Response could not be decoded as JSON&quot;</span>)</a>
<a class="sourceLine" id="cb5-30" title="30"><span class="cf">except</span> <span class="pp">KeyError</span>:</a>
<a class="sourceLine" id="cb5-31" title="31">    response.failure(<span class="st">&quot;Response did not contain expected key &#39;greeting&#39;&quot;</span>)</a></code></pre></div>
<p>¬†</p>
<p>With locust you can test your server fairly quickly with its simple setup</p>
<p>Its configuration is also well docummented, take a look at their official site: <a href="https://docs.locust.io/en/stable/writing-a-locustfile.html">Locust documentation</a> ¬†</p>
<blockquote>
<p>Happy load testing! üõ©Ô∏è</p>
</blockquote>
<p class="footer">site made with: <a target="_blank" href="https://github.com/vbuterin/blogmaker" alt="blog maker">blogmaker</a> - credit to <a href="https://vitalik.ca/" target="_blank" alt"Vitalik's website">Vitalik Buterin</a></p></div> 